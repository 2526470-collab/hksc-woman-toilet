<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å³æ™‚åŒæ­¥ - å¥³æ€§å»æ‰€ç®¡ç†ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; padding: 20px; }
        h1 { text-align: center; color: #cf4f7e; }
        .floor-container { display: flex; flex-direction: column; gap: 20px; max-width: 800px; margin: 0 auto; }
        .floor-card { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 15px; border-left: 5px solid #d81b60; }
        .cubicle-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .cubicle { border: 1px solid #ddd; padding: 10px; text-align: center; border-radius: 4px; }
        .status-btn { border: none; padding: 8px 12px; border-radius: 20px; cursor: pointer; width: 100%; transition: 0.3s; }
        .status-clear { background-color: #e8f5e9; color: #2e7d32; }
        .status-dirty { background-color: #ffebee; color: #c62828; }
    </style>
</head>
<body>

    <h1>ğŸšº å³æ™‚åŒæ­¥ç›£æ§ç³»çµ±</h1>
    <div class="floor-container" id="system-root"></div>

    <script>
        // --- 1. Firebase é…ç½® (è«‹æ›¿æ›æˆæ‚¨è‡ªå·±çš„ API Key) ---
        const firebaseConfig = {
            databaseURL: "https://ä½ çš„å°ˆæ¡ˆID.firebaseio.com" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- 2. ç”Ÿæˆæ¨“å±¤ä»‹é¢ ---
        const floors = ['G', '1', '2', '3', '4', '5'];
        const container = document.getElementById('system-root');

        floors.forEach(floor => {
            const floorDiv = document.createElement('div');
            floorDiv.className = 'floor-card';
            let cubiclesHtml = '';
            for (let i = 1; i <= 5; i++) {
                const id = `${floor}_${i}`;
                cubiclesHtml += `
                    <div class="cubicle">
                        <div>${i} è™Ÿ</div>
                        <button id="${id}" class="status-btn status-clear" onclick="updateDB('${id}')">è¼‰å…¥ä¸­...</button>
                    </div>
                `;
            }
            floorDiv.innerHTML = `<div class="floor-title">${floor} æ¨“</div><div class="cubicle-grid">${cubiclesHtml}</div>`;
            container.appendChild(floorDiv);
        });

        // --- 3. åŒæ­¥é‚è¼¯ ---
        // ç›£è½è³‡æ–™åº«è®ŠåŒ–ä¸¦æ›´æ–°ç•«é¢
        db.ref('toilets').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            for (let floor of floors) {
                for (let i = 1; i <= 5; i++) {
                    const id = `${floor}_${i}`;
                    const btn = document.getElementById(id);
                    const isDirty = data[id] === 'dirty';
                    
                    btn.innerText = isDirty ? 'é«’æ±™' : 'ä¹¾æ·¨';
                    btn.className = `status-btn ${isDirty ? 'status-dirty' : 'status-clear'}`;
                }
            }
        });

        // é»æ“ŠæŒ‰éˆ•æ›´æ–°è³‡æ–™åº«
        function updateDB(id) {
            const btn = document.getElementById(id);
            const nextStatus = btn.innerText === 'ä¹¾æ·¨' ? 'dirty' : 'clear';
            db.ref('toilets/' + id).set(nextStatus);
        }
    </script>
</body>
</html>